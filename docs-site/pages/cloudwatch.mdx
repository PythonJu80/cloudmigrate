# CloudWatch

CloudWatch displays real-time AWS metrics pulled from CloudWatch, CloudTrail, Cost Explorer, and Health APIs.

## Requirements

AWS credentials must be configured in Settings with permissions for:
- `cloudwatch:GetMetricData`
- `cloudwatch:ListMetrics`
- `ce:GetCostAndUsage`
- `ce:GetCostForecast`
- `cloudtrail:LookupEvents`
- `health:DescribeEvents` (requires Business/Enterprise support)
- `ec2:DescribeInstances`
- `ec2:DescribeInstanceStatus`

## Metrics Displayed

### EC2 Metrics

| Metric | Source |
|--------|--------|
| CPU Utilization | AWS/EC2 namespace, Average |
| Network In/Out | AWS/EC2 namespace, Sum (converted to MB) |

### Lambda Metrics

| Metric | Source |
|--------|--------|
| Errors | AWS/Lambda namespace, Sum |
| Invocations | AWS/Lambda namespace, Sum |
| Error Rate | Calculated: errors / invocations |

### Cost Data

From Cost Explorer API:
- Current month spend
- Cost forecast
- Spend by service

## Health Events

If you have AWS Business or Enterprise support, the dashboard shows AWS Health events:
- Open events
- Upcoming maintenance
- Service disruptions

Without Business/Enterprise support, the Health API returns a `SubscriptionRequiredException`.

## Alerts

### Alert Rules

Create alert rules with:
- Name
- Metric (namespace + metric name)
- Condition (greater than, less than)
- Threshold value
- Evaluation period

### Alert Incidents

When a threshold is breached:
1. AlertIncident record created with status OPEN
2. Incident appears in the alerts panel
3. Can be acknowledged or resolved

### Incident Statuses

| Status | Description |
|--------|-------------|
| OPEN | Threshold breached, not acknowledged |
| ACKNOWLEDGED | Seen by user |
| RESOLVED | Metric returned to normal |

## Refresh

Click the refresh button to fetch latest metrics. Data is cached briefly to avoid excessive API calls.

## Data Sources

The monitoring page calls `/api/monitoring/metrics` which:
1. Checks if AWS credentials exist
2. Calls `getFullDashboardMetrics()` for CloudWatch data
3. Calls `getHealthEvents()` for AWS Health data
4. Returns combined data with timestamp
