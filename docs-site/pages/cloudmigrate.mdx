# CloudMigrate

CloudMigrate is a full infrastructure migration platform for moving on-premises workloads to AWS. It provides automated discovery, assessment, and migration execution.

## Migration Workflow

CloudMigrate follows a structured 5-step migration process:

| Step | Purpose |
|------|---------|
| **Discover** | Scan your network to find servers, databases, and services |
| **Assess** | Analyze dependencies, estimate costs, plan migration strategy |
| **Workloads** | Configure migration settings for each workload |
| **Execute** | Run migrations in waves with progress tracking |
| **Validate** | Verify data integrity, performance, and compliance |

## The 12 Migration Categories

CloudMigrate focuses on the workloads that matter most:

| Category | On-Premises | AWS Target |
|----------|-------------|------------|
| **Compute** | VMs, physical servers | EC2, ECS, Lambda |
| **Databases** | SQL Server, Oracle, MySQL, PostgreSQL | RDS, Aurora, DynamoDB |
| **File Storage** | SMB shares, NAS, file servers | FSx, EFS, S3 |
| **Identity** | Active Directory, LDAP | Managed AD, IAM Identity Center |
| **Networks & VPN** | Firewalls, routers, VPN | VPC, VPN, Direct Connect |
| **Web Apps** | IIS, Apache, Nginx | EC2, ECS, Beanstalk, Lambda |
| **Backups / DR** | Veeam, tapes, SAN snapshots | AWS Backup, S3 Glacier |
| **Logging / Monitoring** | Nagios, Zabbix, ELK, Splunk | CloudWatch, OpenSearch, Grafana |
| **DevOps Pipelines** | Jenkins, GitLab, Bitbucket | CodePipeline, CodeBuild |
| **Messaging & Queues** | RabbitMQ, Kafka, ActiveMQ | SQS, SNS, MSK |
| **Email / SMTP** | Exchange, SMTP relays | SES, WorkMail |
| **Batch Jobs / Cron** | Cron servers, Task Scheduler | EventBridge, Batch, Step Functions |

## Discovery

### CloudMigrate Agent

The CloudMigrate Agent is a lightweight Go binary that runs on your network to discover infrastructure.

#### Installation

```bash
# Download the agent
curl -L https://cloudmigrate.io/agent/latest -o cloudmigrate-agent
chmod +x cloudmigrate-agent

# Connect to your CloudMigrate account
./cloudmigrate-agent connect --api-key YOUR_API_KEY
```

#### Running Discovery

```bash
# Auto-detect and scan local networks
./cloudmigrate-agent discover

# Scan a specific subnet
./cloudmigrate-agent discover 192.168.1.0/24

# Deep scan with banner grabbing
./cloudmigrate-agent discover --deep
```

#### Daemon Mode

For continuous monitoring and remote command execution:

```bash
./cloudmigrate-agent daemon --api-key YOUR_API_KEY
```

The agent polls for commands every 30 seconds and executes discovery scans triggered from the UI.

### What Gets Discovered

The agent scans for:

- **Hosts**: IP address, hostname, MAC address, OS detection
- **Open Ports**: TCP port scanning on 50+ common ports
- **Services**: Database servers, web servers, mail servers, etc.
- **AWS Mapping**: Automatic recommendation of target AWS service

### Service Detection

| Port | Service | AWS Target |
|------|---------|------------|
| 22 | SSH | EC2 |
| 80, 443 | HTTP/HTTPS | EC2/ECS/ALB |
| 3306 | MySQL | RDS MySQL |
| 5432 | PostgreSQL | RDS PostgreSQL |
| 1433 | SQL Server | RDS SQL Server |
| 27017 | MongoDB | DocumentDB |
| 6379 | Redis | ElastiCache |
| 445 | SMB | FSx |
| 389 | LDAP | Managed AD |
| 5672 | RabbitMQ | SQS/MQ |
| 9092 | Kafka | MSK |

## Assessment

After discovery, CloudMigrate analyzes your infrastructure:

- **Dependency Mapping**: Identify connections between services
- **Readiness Score**: Rate each workload's migration readiness
- **Cost Estimation**: Compare on-prem vs AWS costs
- **Risk Analysis**: Flag potential migration blockers

## Workloads

Configure migration settings for each discovered asset:

- **Migration Strategy**: Rehost, Replatform, Refactor, etc.
- **Target Configuration**: Instance type, storage, networking
- **Dependencies**: Define migration order based on dependencies
- **Schedule**: Set migration windows

## Execution

Run migrations in controlled waves:

- **Wave Planning**: Group related workloads
- **Progress Tracking**: Real-time status updates
- **Rollback Support**: Revert if issues detected
- **Parallel Execution**: Migrate multiple workloads simultaneously

## Validation

Post-migration verification:

- **Data Integrity**: Checksum validation
- **Performance Testing**: Compare baseline metrics
- **Connectivity Tests**: Verify network access
- **Compliance Reports**: Generate audit documentation

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/migrate/discover` | GET | Get discovered hosts |
| `/api/migrate/discover` | POST | Receive agent scan results |
| `/api/migrate/discover/trigger` | POST | Trigger discovery scan |
| `/api/migrate/stats` | GET | Get migration statistics |
| `/api/agent/commands` | GET | Agent polls for commands |
| `/api/agent/commands/[id]` | PATCH | Agent updates command status |

## Database Models

### DiscoveryScan

Records each network scan:
- `scanId`: Unique scan identifier
- `networkCidr`: Target network range
- `hostsFound`: Number of hosts discovered
- `summary`: Category breakdown

### DiscoveredHost

Individual discovered servers:
- `ip`, `hostname`, `mac`: Network identity
- `os`, `osVersion`: Operating system
- `category`: Workload type (compute, database, etc.)
- `awsTarget`: Recommended AWS service
- `openPorts`, `services`: Detected services
- `migrationStatus`: discovered → assessed → ready → migrating → migrated

### MigrationWorkload

Grouped assets for migration:
- `sourceType`, `sourceConfig`: On-prem configuration
- `awsService`, `targetConfig`: AWS target configuration
- `status`, `progress`: Migration state
- `estimatedCost`: Monthly AWS cost estimate
